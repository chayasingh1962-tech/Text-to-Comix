<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Comic App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .page { display: none; }
        .page.active { display: block; }
        .panel { 
            background: white; 
            border: 3px black solid; 
            border-radius: 10px; 
            position: relative;
            margin: 10px;
            height: 220px;
            overflow: hidden;
        }
        .speech-bubble {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: white;
            border: 2px black solid;
            border-radius: 20px;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 14px;
            max-height: 60px;
            overflow: hidden;
        }
        .character-svg {
            width: 80px;
            height: 100px;
            margin: 10px auto;
            display: block;
        }
        .comic-container {
            max-height: 70vh;
            overflow-y: auto;
            border: 2px #ccc solid;
            border-radius: 10px;
            padding: 10px;
            background: #f9f9f9;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-200 min-h-screen p-4">
    <!-- Page 1: Prompt Input -->
    <div id="promptPage" class="page active max-w-md mx-auto bg-white rounded-xl shadow-xl p-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">üìñ Text to Comic</h1>
        <textarea id="promptInput" class="w-full p-4 border-2 border-gray-300 rounded-lg resize-vertical min-h-[200px] text-lg focus:outline-none focus:border-blue-500" placeholder="Enter your story here...&#10;&#10;Ex: A brave knight finds a magic sword. He fights a dragon. The village cheers!"></textarea>
        <button onclick="generateComic()" class="w-full mt-6 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-4 px-6 rounded-lg text-xl font-bold hover:from-blue-600 hover:to-purple-600 transition duration-300 shadow-lg">‚ú® Create Comic</button>
        <p class="text-sm text-gray-500 mt-4 text-center">Works offline! Max 45 pages.</p>
    </div>

    <!-- Page 2: Comic Viewer -->
    <div id="comicPage" class="page max-w-4xl mx-auto bg-white rounded-xl shadow-xl p-8">
        <div class="flex justify-between items-center mb-6 sticky top-0 bg-white py-2">
            <button onclick="backToPrompt()" class="text-2xl font-bold text-gray-700 hover:text-gray-900">‚Üê Back</button>
            <h1 class="text-3xl font-bold text-center text-gray-800">Your Comic Book</h1>
            <button id="doneBtn" onclick="saveComic()" class="text-3xl text-green-500 hover:text-green-600 font-bold">‚úÖ Save</button>
        </div>
        
        <div id="comicContainer" class="comic-container mb-8">
            <!-- Panels added here -->
        </div>

        <!-- Settings -->
        <div class="bg-gradient-to-r from-gray-100 to-gray-200 p-6 rounded-xl sticky bottom-4 shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">‚öôÔ∏è Settings</h2>
            <div class="flex flex-wrap gap-4 items-center justify-center">
                <label class="flex items-center gap-3 p-3 bg-white rounded-lg shadow-md">
                    <input type="checkbox" id="enableAudio" checked class="w-5 h-5">
                    <span class="font-semibold">üîä Audio Narration</span>
                </label>
                <button id="addPageBtn" onclick="addPage()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-bold shadow-md transition">+ New Page</button>
                <span id="pageCount" class="font-bold text-xl bg-blue-100 px-4 py-2 rounded-full">Page 1 / 45</span>
            </div>
        </div>
    </div>

    <!-- Share Page -->
    <div id="sharePage" class="page max-w-4xl mx-auto bg-white rounded-xl shadow-xl p-8 max-h-screen overflow-y-auto">
        <h1 class="text-3xl font-bold text-center mb-8 text-green-600">üéâ Comic Saved Successfully!</h1>
        <div id="comicPreview" class="comic-container mb-8 max-h-96"></div>
        <div class="flex gap-4 justify-center">
            <button onclick="shareComic()" class="bg-green-500 hover:bg-green-600 text-white py-4 px-8 rounded-lg text-xl font-bold shadow-lg transition flex items-center gap-2">
                üì± Share Comic
            </button>
            <button onclick="backToPrompt()" class="bg-blue-500 hover:bg-blue-600 text-white py-4 px-8 rounded-lg text-xl font-bold shadow-lg transition">
                ‚ûï New Comic
            </button>
        </div>
    </div>

    <script>
        let pages = [];
        let currentPageIndex = 0;
        const maxPages = 45;

        // Simple SVG character generator (works offline!)
        function createCharacterSVG(type = 'happy') {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            let face = '';
            if (type === 'happy') {
                face = `<circle cx="40" cy="35" r="3" fill="#333"/><circle cx="60" cy="35" r="3" fill="#333"/><path d="M35 50 Q50 60 65 50" stroke="#333" stroke-width="2" fill="none"/>`;
            } else if (type === 'sad') {
                face = `<circle cx="40" cy="40" r="3" fill="#333"/><circle cx="60" cy="40" r="3" fill="#333"/><path d="M35 55 Q50 65 65 55" stroke="#333" stroke-width="2" fill="none" transform="scale(1,1.2)"/>`;
            }
            return `<svg viewBox="0 0 100 120" class="character-svg"><rect x="20" y="10" width="60" height="70" rx="30" fill="${color}" stroke="#333" stroke-width="3"/><circle cx="30" cy="25" r="8" fill="#fff"/><circle cx="70" cy="25" r="8" fill="#fff"/><circle cx="30" cy="25" r="4" fill="#333"/><circle cx="70" cy="25" r="4" fill="#333"/>${face}<path d="M20 80 L50 100 L80 80" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round"/></svg>`;
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function generateComic() {
            const text = document.getElementById('promptInput').value.trim();
            if (!text) {
                alert('üòä Please enter your story text!');
                return;
            }

            // Better sentence splitting: split on . ! ? but keep words together
            const sentences = text.replace(/([.!?]+)/g, '$1|').split('|').map(s => s.trim()).filter(s => s.length > 5);
            
            pages = [];
            const panelsPerPage = 6;
            for (let i = 0; i < sentences.length; i += panelsPerPage) {
                pages.push(sentences.slice(i, i + panelsPerPage));
            }

            if (pages.length === 0) {
                alert('Story too short! Add more sentences.');
                return;
            }

            currentPageIndex = 0;
            renderCurrentPage();
            showPage('comicPage');
        }

        function renderCurrentPage() {
            const container = document.getElementById('comicContainer');
            const page = pages[currentPageIndex] || [];
            
            container.innerHTML = `
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${page.map((text, idx) => `
                        <div class="panel bg-gradient-to-br from-yellow-50 to-orange-50 hover:shadow-xl transition">
                            ${createCharacterSVG(idx % 2 ? 'happy' : 'sad')}
                            <div class="speech-bubble">${text.substring(0, 100)}${text.length > 100 ? '...' : ''}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('pageCount').textContent = `Page ${currentPageIndex + 1} / ${Math.min(pages.length, maxPages)}`;
        }

        function addPage() {
            if (pages.length >= maxPages) {
                alert(`Max ${maxPages} pages reached!`);
                return;
            }
            pages.push(['Add text to this new panel... Click Save to edit!']);
            currentPageIndex = pages.length - 1;
            renderCurrentPage();
        }

        function speakPage() {
            const text = pages[currentPageIndex].map(p => p.replace(/[^ws.,!?]/g, '')).join('. ');
            if (speechSynthesis.speaking) speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9;
            utterance.pitch = 1;
            speechSynthesis.speak(utterance);
        }

        function saveComic() {
            const fullComic = pages.map((page, pidx) => 
                `<div class="page-${pidx}"><h3>Page ${pidx+1}</h3><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">${page.map((text, idx) => `<div class="panel">${createCharacterSVG()} <div class="speech-bubble">${text}</div></div>`).join('')}</div>`
            ).join('');
            
            const comicHTML = `<!DOCTYPE html><html><head><title>My Comic Book</title><script src="https://cdn.tailwindcss.com"></script><style>.panel{border:3px solid black;border-radius:10px;height:250px;margin:10px;position:relative;}.speech-bubble{position:absolute;bottom:10px;left:10px;right:10px;background:white;border:2px solid black;border-radius:20px;padding:10px;font-weight:bold;}.character-svg{width:100px;height:120px;margin:10px auto;display:block;}</style></head><body class="p-8 bg-gradient-to-br from-blue-100 to-purple-200">${fullComic}</body></html>`;
            
            const blob = new Blob([comicHTML], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `my-comic-book-${Date.now()}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            document.getElementById('comicPreview').innerHTML = container.innerHTML;
            showPage('sharePage');
        }

        function shareComic() {
            if (navigator.share) {
                navigator.share({title: 'My Comic Book', text: 'Check out my awesome comic!', url: window.location.href});
            } else {
                navigator.clipboard.writeText(window.location.href).then(() => alert('üìã Link copied! Share it anywhere.'));
            }
        }

        function backToPrompt() {
            showPage('promptPage');
            document.getElementById('promptInput').focus();
        }

        // Events
        document.getElementById('enableAudio').addEventListener('change', speakPage);
        document.addEventListener('keydown', (e) => {
            if (!document.getElementById('comicPage').classList.contains('active')) return;
            if (e.key === 'ArrowLeft' && currentPageIndex > 0) { currentPageIndex--; renderCurrentPage(); }
            else if (e.key === 'ArrowRight' && currentPageIndex < pages.length - 1) { currentPageIndex++; renderCurrentPage(); }
        });

        // Auto-enter on prompt
        document.getElementById('promptInput').addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') generateComic();
        });
    </script>
</body>
    </html>
